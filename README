Twisted.Web Debian Package
==========================

Our Motto: Making Twisted.Web look like Apache since 2002

Configuration
-------------

Explanation of Default Configuration
- - - - - - - - - - - - - - - - - - 

The default's configuration goals are the following, in this order

* Maximum safety - Always err on side of locking down too much, and let the
  user open up options of dunvious safety.
* Maximum familiarity - If the choices don't present any inherent danger,
  configure to be as similar to the standard web server configuration. The
  Apache configuration being the most thorough is the reason for the motto.
* Maximum flexibility - As long as it is not unsafe nor too surprising, try
  to have a configuration which lends as much power to the end user.

The user it runs as (after binding to port 80) is www-data, and the
group is also www-data.

By default, the configuration is to handle all hostnames to be the same --
all pointing to /var/www. No "processors" are enabled, so it is possible
to allow untrusted parties to put files in /var/www without giving them
the ability to run code as www-data. 

/doc is pointed to /usr/share/doc/, so all the debian documentation is
served by default (which means, for example, dhelp works).

/cgi-bin is pointed to /usr/lib/cgi-bin/, so third-party packages CGI
(mailman, man2html) are likewise served.

/users/<name>/ points to the user's public_html directory.

/users/<name>.twistd/ will relay requests to the user personal server,
if it exists.

/~name/, or /~name.twistd/, function the same as /users/name/ or
/users/name.twistd/.

Any documents with unrecognized extension are served as text/html.

Modifications and Smooth Upgrades
- - - - - - - - - - - - - - - - -

In order to avoid modifying the configuration files so maintainer updates
can happen smoothly, please put local configuration files in
/etc/twisted-web/local.d
All .py files in this directory are evaluated according to lexical order.
It is recommended files will begin with two digits to set the order.
All example drop-in configuation files follow this convention.   

Drop-in configuration files are evaluated inside a namespace consisting
of 
- root -- the root resource, usually a NameVirtualHost
- default -- the default File root for names which are not virtual hosts
- site -- a web.server.Site, the factory
- application -- a twisted.internet.app.Application

Dynamic User Pages
- - - - - - - - - 

In order to let users' home dirs be able to have dynamic pages, enable
twisted-web-users by removing the "exit 0" from /etc/default/twisted-web-users.
A user who wants dynamic pages should put in his $HOME/.twisted-command
a command which accepts "--pidfile=<file>" and starts a so-called 
"personal server". The easiest way to do this is to use the mktap web
command with the --personal argument, and put in $HOME/.twisted-command
something like
'''
twistd2.2 -f ~/web.tap $1
'''

Reverse Proxy Configuration
- - - - - - - - - - - - - - 

If some other program is running on port 80 Twisted-Web will be disabled until
you change /etc/twisted-web/disable to be empty. You should do this after
changing the configuration of Twisted-Web to listen on some other port, or
changing the configuration of the other server. After undisabling Twisted-Web,
run the command "invoke-rc.d twisted-web" to start the server manually.

rptwisted exists to run Twisted on an out-of-the-way port and prepare it
to be a reverse proxy.  It will reconfigure Twisted-Web to run on another
port, and will also, optionally, drop a file in Apache2's configuration
directory to reverse proxy a named virtual host to the Twisted-Web server.

If you don't use the option to generate the Apache2 virtual host configuration,
or if you want to add more virtual host configurations, here is the template
for a file to drop in /etc/apache2/sites-available:

'''
<VirtualHost *>
ProxyPass / http://localhost:8538/vhost/http/example.com:80/
ServerName example.com
</VirtualHost>
'''

Remember to symlink it to sites-enabled, and restart Apache2!

Further Resources
-----------------
For more explanations about how Twisted.Web works, pleases see the
"Using Twisted.Web" HOWTO, available at
/usr/share/doc/twisted-doc/howto/using-twistedweb.xhtml when you
install the "twisted-doc" package.
